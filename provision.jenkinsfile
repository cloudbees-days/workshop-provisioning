pipeline {
   agent any

   stages {
      stage('Setup cluster') {
         steps {
            dir('terraform/cluster') {
                withEnv(['TF_VAR_bucket=cbws-cluster-bucket', 'TF_VAR_project=cb-days-workshop', 'TF_VAR_domain_zone=cbws-io', 'TF_VAR_domain=cbws.io', 'TF_VAR_region=us-central1', 'TF_VAR_cluster_name=cbws1']) {
                    sh 'terraform init'
                    sh 'terraform apply -auto-approve'
                }
            }
         }
      }
   }
}
